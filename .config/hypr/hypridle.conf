#This file can also be edited easily with a GUI by right clicking the battery/power module/icon on waybar. 
general {
    # LOCK COMMAND
    # Run hyprlock. 'pidof' prevents launching multiple instances.
    lock_cmd = pidof hyprlock || hyprlock

    # BEFORE SLEEP
    # Ensure the session locks before the computer actually goes to sleep.
    before_sleep_cmd = loginctl lock-session

    # AFTER SLEEP
    # Turn the display back on immediately upon waking to ensure the login prompt is visible.
    after_sleep_cmd = hyprctl dispatch dpms on
}

# ==============================================================================
# 1. DIM KEYBOARD BACKLIGHT (Asus TUF F15 Specific)
# ==============================================================================
# Action: Turn off keyboard backlight completely to save battery.
# Note: Check if your device is named 'asus::kbd_backlight' via 'brightnessctl --list'
listener {
    timeout = 140
    on-timeout = brightnessctl -sd asus::kbd_backlight set 0
    on-resume = brightnessctl -rd asus::kbd_backlight
}

# ==============================================================================
# 2. DIM SCREEN BRIGHTNESS
# ==============================================================================
# Action: Dim screen to minimum (1) but keep it visible as a warning.
listener {
    timeout = 150
    on-timeout = brightnessctl -s set 1
    on-resume = brightnessctl -r
}

# ==============================================================================
# 3. LOCK SESSION
# ==============================================================================
# Action: Lock the screen. 
listener {
    timeout = 300
    on-timeout = loginctl lock-session
}

# ==============================================================================
# 4. SCREEN OFF (DPMS)
# ==============================================================================
# Action: Turn off the monitor power completely.
# This is critical for saving battery if the system doesn't fully suspend.
listener {
    timeout = 330
    on-timeout = hyprctl dispatch dpms off
    on-resume = hyprctl dispatch dpms on
}

# ==============================================================================
# 5. SUSPEND SYSTEM
# ==============================================================================
# Action: Suspend the PC.
#
# LOGIC & HIERARCHY:
# We use `pactl list sinks | grep -q "State: RUNNING"` to detect if audio is playing.
# This command acts as a "gate": if audio is detected (exit code 0), the command 
# chain stops (||), effectively canceling the suspend action.
#
# WHY IT IS HERE:
# Placing this check here allows the earlier stages (Dim Screen, Lock, Screen Off) 
# to proceed normally while listening to music, but prevents the final "Suspend" 
# which would kill the audio stream.
#
# CUSTOMIZATION:
# Hypridle listeners process in parallel, but logically, if you prevent an earlier 
# stage (like Screen Off), the user effectively never reaches the "Suspend" state.
# - To keep the screen ON while listening to music:
# Move the `pactl list sinks | grep -q "State: RUNNING" ||` check up to the 
# "SCREEN OFF" (DPMS) listener.
# - To keep the screen BRIGHT while listening to music: Move it up to the 
#   "DIM SCREEN" listener.

listener {
    timeout = 600
    on-timeout = pactl list sinks | grep -q "State: RUNNING" || systemctl suspend
}
